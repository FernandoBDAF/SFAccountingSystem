@model ICollection<RecordOFXSubGroup>
@{
    ViewData["Title"] = "Subgroups";
}

<div class="container">
    <div class="row">
        <div class="col-md-12">

            

            @if (ViewBag.Subgroup.ParentId != null)
            {
                <h1 class="mb-4">Groups -> @(Enum.GetName(typeof(RecordOFXGroup), @Model.Select(x => (int)x.Group)
                    .FirstOrDefault())) -> @ViewBag.Subgroup.ParentId -> @ViewBag.Subgroup.Description</h1>
                <a class="btn btn-primary" href="/RecordOFXSubGroup/IndexChildrens/@ViewBag.Subgroup.ParentId">Back</a>
            }
            else
            { 
                <h1 class="mb-4">Groups -> @(Enum.GetName(typeof(RecordOFXGroup), @Model.Select(x => (int)x.Group)
                    .FirstOrDefault())) -> @ViewBag.Subgroup.Description</h1>
                <a class="btn btn-primary" href="/RecordOFXSubGroup/IndexSubGroup/@((int)ViewBag.Subgroup.Group)">Back</a> @*Group´eh um enum*@
            }

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Direct Childrens</th>
                        <th>Total Childrens</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (RecordOFXSubGroup subgroup in Model)
                    {
                        @if (subgroup.ParentId == ViewBag.Subgroup.Id)
                        {
                                <tr>
                                    <td>@subgroup.Description</td>
                                    <td>@Model.Where(x => x.ParentId == @subgroup.Id).Count()</td>
                                    <td>?</td>
                                    <td>
                                        <a class="btn btn-secondary" href="/RecordOFXSubGroup/CreateSubChildren">Insert Node</a>
                                        <a class="btn btn-secondary" href="/RecordOFXSubGroup/IndexChildrens/@subgroup.Id">List</a>
                                        <a class="btn btn-secondary" href="/RecordOFXSubGroup/Update/@subgroup.Id">Edit</a>
                                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" data-delete-url="/RecordOFXSubGroup/Delete/@subgroup.Id">Delete</button>
                                @*repensar como organizar esse arquivo ate para poder reutilizar os scripts de confirmacao de delecao em outros arquivos*@
                                    </td>
                                </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


@*repensar como organizar esse arquivo ate para poder reutilizar os scripts de confirmacao de delecao em outros arquivos*@

<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Do you really want to DELETE this entry?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a id="confirmDeleteBtn" class="btn btn-danger">Delete</a>
      </div>
    </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    var deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
    var confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

    deleteConfirmationModal.addEventListener('show.bs.modal', function(event) {
      var button = event.relatedTarget;
      var deleteUrl = button.getAttribute('data-delete-url');
      confirmDeleteBtn.setAttribute('href', deleteUrl);
    });
  });
</script>

